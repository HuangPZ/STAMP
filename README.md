# Artifact Appendix

Paper title: **Efficient Privacy-Preserving Machine Learning with Lightweight Trusted Hardware**

Artifacts HotCRP Id: **#Enter your HotCRP Id here**

Requested Badge: Either **Reproducible**

## Description

A maliciously secure framework for efficient 3-party trusted hardware aided protocols for neural networks inference. This work builds off [Falcon](https://github.com/snwagh/
falcon-public) and other prior works. This frame work does the inter-party communication and CPU computation that happens during the protocol, and generate the LTH bandwidth usage numbers for simulation of LTH overhead.

## Basic Requirements
---
* The code has been developed and tested with [Ubuntu](http://www.ubuntu.com/) 20.04 on x86 machines.

### Accessibility
The code is also publicly available in the github repo. (TODO)

#### Repository Structure

* `files/`    - Shared keys, IP addresses and data files.
* `files/preload`    - Contains data for pretrained network from SecureML. The other networks can be generated using `scripts` and functions in `secondary.cpp`
* `lib_eigen/`    - [Eigen library](http://eigen.tuxfamily.org/) for faster matrix multiplication.
* `src/`    - Source code of STAMP.
* `util/` - Dependencies for AES randomness.
* `output/` - Detailed output of runtime and breakdown of overhead.
* `scripts/` - Contains python code to generate trained models for accuracy testing over a batch.
* `Arduino/` - Contains example code that runs on an Arduino Due realizing part of the functionalities acting as the LTH with interface communicating the local code. This is only for demostrating purpose which is **not used to collect the actual results**, and the default code that runs the actual experiments do not communicate with it.

## Environment
* **Basic Required packages for STAMP:**
  g++
  make
  libssl-dev
  libzmq3-dev

  Install these packages with your package manager, e.g, `sudo apt-get install <package-name>`.

## Building the code

To build STAMP, run the following commands:

```
make all -j$(nproc)
```


## Testing the framework
- The defualt makefile uses CUDA and cudatoolkit/driver is needed for compiling and running. Make sure to check the CUDA location matches your environment. You can change the make file line:
```
USE_CUDA := 1
```
and the global.h
```
#define USE_CUDA true
```
to run CPU only experiments. You can change the makefile SECURITY:= Semi-honest or SECURITY:= Malicious to control the threat model before compiling.

- To test on a single terminal, use `make terminal` - runs locally by defualt
- To test on a distributed setup, use `make zero/ make one/ make two` as three process (on three machines potentially). You may change the IP files in ./files/ and the RUN_TYPE in makefile to control the connections.
- You may need to create an `outout\` folder if it does not exist.

You may change the main.cpp if you only want to test on specific networks. 


#### Quick Debugging suggestions
If an "address taken" error occurs after make terminal, please use 
```
pkill STAMP.out
```
to kill all running STAMP program in the background if your previous run did not exit normally.

### LTH Hardware and experiments
The LTH part of the STAMP is tested on Arduino Due which publicly available for purchase in Arduino official sites. The LTH communication overhead is estimated using the bandwidth usage number generated by this code. The computation overhead is collected by simply performing the estimated amount of operations (which are mainly int32 addition and fewer multiplications). 